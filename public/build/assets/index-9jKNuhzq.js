import{j as r,B as R,R as P,a as c,O as T,r as p,c as w}from"./chunk-K6AXKMTT-CWEwRGCy.js";import{c as y,g as U,G as E,a as S,p as q,b as _,d as b,e as k,u as L,f as $,s as F,P as Q}from"./index-EFx69h3B.js";import{b as v,c as i,s as h,a as B,U as d}from"./theme_env-DN2tYCTm.js";import{T as I}from"./getComponent-DC4w6AQX.js";const l=y({reducerPath:"authApi",baseQuery:v,tagTypes:["User","LoggedInUser","UserProfileUpdate","UserUpdatePassword","PasswordForgotRequest","PasswordReset","DashboardAnalytics"],endpoints:t=>({login:t.mutation({query:e=>i({url:`${d}/login`,method:"post",body:e}),invalidatesTags:["User"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:a}){await a.then(o=>{s(h({user:o.data.data.user,accessToken:o.data.data.access_token}))})}}),register:t.mutation({query:e=>i({url:`${d}/register`,method:"post",body:e}),invalidatesTags:["User"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:a}){await a.then(o=>{s(h({user:o.data.data.user,accessToken:o.data.data.access_token}))})}}),logOut:t.mutation({query:e=>i({url:`${d}/logout`,method:"get",body:e}),invalidatesTags:["User"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:a}){await a.then(()=>{s(B())})}})})}),G=U({baseUrl:E,prepareHeaders:t=>(t.set("accept","application/json"),t)}),O=({url:t,method:e="GET",body:s,apiMethod:a})=>a?{url:t,method:e,body:{...s,_method:a}}:{url:t,method:e,body:s},C={store:null},x=S({name:"store",initialState:C,reducers:{setStore:(t,e)=>{t.store=e.payload},clearStore:t=>{t.store=null}}}),{setStore:D,clearStore:oe}=x.actions,z=x.reducer,u=y({reducerPath:"storeApi",baseQuery:G,tagTypes:["Store"],endpoints:t=>({fetchStore:t.query({query:e=>O({url:`/store?domain=${e.slug}`,method:"get"}),providesTags:["Store"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:a}){await a.then(o=>{var n,m;s(D((m=(n=o==null?void 0:o.data)==null?void 0:n.data)==null?void 0:m.store))})}})})}),{useFetchStoreQuery:H}=u,N={user:null,accessToken:null},X=S({name:"auth",initialState:N,reducers:{setUser:(t,e)=>{t.user=e.payload},removeUser:t=>{t.user=null},setAuth:(t,e)=>{t.user=e.payload.user,t.accessToken=e.payload.accessToken},clearAuth:t=>{t.accessToken=null,t.user=null}}}),J=X.reducer,K={key:"site",blacklist:["storeApi"],storage:F,version:0},M=q(K,_({store:z,auth:J,[u.reducerPath]:u.reducer,[l.reducerPath]:l.reducer})),f=b({reducer:M,middleware:t=>t({serializableCheck:!1}).concat([u.middleware,l.middleware])});k(f);L.withTypes();const V=$.withTypes(),W=window.document;var g;const j=(g=W.head.querySelector('meta[name="site-slug"]'))==null?void 0:g.content,A=()=>{const{isLoading:t}=H({slug:j}),{store:e}=V(s=>s.store);return{fetchStore:{isLoading:t},store:e}},Y=function(t){const{store:e}=A();return r.jsx(r.Fragment,{children:t.widgets.slice().sort(function(s,a){return s.serial-a.serial}).map(s=>r.jsx(r.Fragment,{children:e&&e.theme&&r.jsx(I,{store:e,widget:s,theme:e.theme})}))})},Z=()=>r.jsx("div",{children:"LoginPage"}),ee=function(){var s,a;const{store:t,fetchStore:e}=A();return r.jsx(r.Fragment,{children:r.jsx(R,{basename:`/sites/${j}`,children:t?r.jsx(r.Fragment,{children:r.jsx(P,{children:((s=t.pages)==null?void 0:s.length)>0?(a=t==null?void 0:t.pages)==null?void 0:a.map((o,n)=>r.jsxs(c,{path:"/",element:r.jsx(T,{}),children:[r.jsx(c,{path:o.type.type==="home"?"/":o.slug,index:!0,element:p.createElement(Y,{...o,key:n})},n),r.jsx(c,{path:"/login",index:!0,element:r.jsx(Z,{})},n)]})):r.jsx(c,{index:!0,element:r.jsx("h1",{children:"No page created."})})})}):r.jsx(r.Fragment,{children:e.isLoading&&"loading.."})})})};document.getElementById("root")&&w.createRoot(document.getElementById("root")).render(r.jsx(Q,{store:f,children:r.jsx(p.StrictMode,{children:r.jsx(ee,{})})}));
