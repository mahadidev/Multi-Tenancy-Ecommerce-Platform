import{j as a,B as C,R as M,a as S,O as z,r as U,c as H}from"./chunk-K6AXKMTT-DJhFqiHr.js";import{c as x,h as N,G as J,a as P,p as W,b as X,d as K,e as V,u as Y,f as Z,s as ee,P as te}from"./index-BypGhPN_.js";import{c as re}from"./baseQueryWithReAuth-BVScCZ2W.js";import{T as se}from"./getComponent-Btf3Vz65.js";const ae=window.document;var T;const j=(T=ae.head.querySelector('meta[name="site-slug"]'))==null?void 0:T.content,g="/user",oe={user:null,accessToken:null,userProfileData:null},w=x({name:"auth",initialState:oe,reducers:{setUser:(t,e)=>{t.user=e.payload},removeUser:t=>{t.user=null},setAuth:(t,e)=>{t.user=e.payload.user,t.accessToken=e.payload.accessToken},setUserProfile:(t,e)=>{t.userProfileData=e.payload},clearAuth:t=>{t.accessToken=null,t.userProfileData=null,t.user=null}}}),{setUser:ke,removeUser:qe,setAuth:R,clearAuth:f,setUserProfile:ne}=w.actions,ie=w.reducer,A=N({baseUrl:J,prepareHeaders:(t,e)=>{t.set("accept","application/json");let r=e.getState().auth.accessToken;return r||(r=JSON.parse(localStorage.getItem("persist:site")||"{}").auth.accessToken),r&&t.set("authorization",`Bearer ${r}`),t}}),ue=async(t,e,s)=>{const r=await A(t,e,s);return r.error&&r.error.status===401&&e.dispatch(f()),r},h=({url:t,method:e="GET",body:s,apiMethod:r})=>r?{url:t,method:e,body:{...s,_method:r}}:{url:t,method:e,body:s},m=P({reducerPath:"authApi",baseQuery:A,tagTypes:["User","LoggedInUser","UserProfileUpdate","UserUpdatePassword","PasswordForgotRequest","PasswordReset","DashboardAnalytics"],endpoints:t=>({login:t.mutation({query:e=>h({url:`${g}/login?store_id=${e.store_id}`,method:"post",body:e}),invalidatesTags:["User"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:r}){await r.then(o=>{s(R({user:o.data.data.user,accessToken:o.data.data.access_token}))})}}),register:t.mutation({query:e=>h({url:`${g}/register`,method:"post",body:e}),invalidatesTags:["User"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:r}){await r.then(o=>{s(R({user:o.data.data.user,accessToken:o.data.data.access_token}))})}}),logOut:t.mutation({query:e=>h({url:`${g}/logout`,method:"get",body:e}),invalidatesTags:["User"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:r}){await r.then(()=>{s(f())}).catch(()=>{s(f())})}})})}),{useLoginMutation:ce,useRegisterMutation:de,useLogOutMutation:le}=m,ge={store:null},E=x({name:"store",initialState:ge,reducers:{setStore:(t,e)=>{t.store=e.payload},clearStore:t=>{t.store=null}}}),{setStore:he,clearStore:_e}=E.actions,me=E.reducer,p=P({reducerPath:"storeApi",baseQuery:A,tagTypes:["Store"],endpoints:t=>({fetchStore:t.query({query:e=>h({url:`/store?domain=${e.slug}`,method:"get"}),providesTags:["Store"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:r}){await r.then(o=>{var c,l;s(he((l=(c=o==null?void 0:o.data)==null?void 0:c.data)==null?void 0:l.store))})}})})}),{useFetchStoreQuery:pe}=p,y=P({reducerPath:"userApi",baseQuery:ue,tagTypes:["Profile"],endpoints:t=>({fetchUserProfile:t.query({query:()=>re({url:`${g}/profile`,method:"GET"}),providesTags:["Profile"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:r}){await r.then(o=>{s(ne(o.data.data.user))})}})})}),{useFetchUserProfileQuery:ye}=y,Se={key:"site",blacklist:["storeApi","authApi","userApi"],storage:ee,version:0},fe=W(Se,X({store:me,auth:ie,[p.reducerPath]:p.reducer,[m.reducerPath]:m.reducer,[y.reducerPath]:y.reducer})),k=K({reducer:fe,middleware:t=>t({serializableCheck:!1}).concat([p.middleware,m.middleware,y.middleware])});V(k);Y.withTypes();const L=Z.withTypes(),q=()=>{const{isLoading:t}=pe({slug:j}),{store:e}=L(s=>s.store);return{fetchStore:{isLoading:t},store:e}},Pe=()=>{const{user:t}=L(n=>n.auth),[e,{isLoading:s,error:r,data:o,isSuccess:c}]=ce(),l=({formData:n,onSuccess:i})=>{e(n).then(u=>{var d;((d=u.data)==null?void 0:d.status)===200&&i&&i(u.data)})},[_,{isLoading:b,error:O,data:$,isSuccess:Q}]=de(),D=({formData:n,onSuccess:i})=>{_(n).then(u=>{var d;((d=u.data)==null?void 0:d.status)===200&&i&&i(u.data)})},[F,{isLoading:v,isSuccess:B,error:I,data:G}]=le();return{user:t,login:{submit:l,isLoading:s,error:r,data:o,isSuccess:c},register:{submit:D,isLoading:b,error:O,data:$,isSuccess:Q},logOut:{submit:({onSuccess:n})=>{F().then(i=>{var u;((u=i.data)==null?void 0:u.status)===200&&n&&n(i.data.data)})},isLoading:v,error:I,data:G,isSuccess:B}}},Ae=()=>{const{userProfileData:t}=L(e=>e.auth);return ye(),{userProfileData:t}},Le=()=>({useAuth:Pe,useUser:Ae}),Re=function(t){const{store:e}=q(),s=Le();return a.jsx(a.Fragment,{children:t.widgets.slice().sort(function(r,o){return r.serial-o.serial}).map(r=>a.jsx(a.Fragment,{children:e&&e.theme&&a.jsx(se,{store:e,widget:r,theme:e.theme,hooks:s})}))})},Te=function(){var s,r;const{store:t,fetchStore:e}=q();return a.jsx(a.Fragment,{children:a.jsx(C,{basename:`/sites/${j}`,children:t?a.jsx(a.Fragment,{children:a.jsx(M,{children:((s=t.pages)==null?void 0:s.length)>0?(r=t==null?void 0:t.pages)==null?void 0:r.map((o,c)=>a.jsx(S,{path:"/",element:a.jsx(z,{}),children:a.jsx(S,{path:o.type.type==="home"?"/":o.slug,index:!0,element:U.createElement(Re,{...o,key:c})},c)})):a.jsx(S,{index:!0,element:a.jsx("h1",{children:"No page created."})})})}):a.jsx(a.Fragment,{children:e.isLoading&&"loading.."})})})};document.getElementById("root")&&H.createRoot(document.getElementById("root")).render(a.jsx(te,{store:k,children:a.jsx(U.StrictMode,{children:a.jsx(Te,{})})}));
