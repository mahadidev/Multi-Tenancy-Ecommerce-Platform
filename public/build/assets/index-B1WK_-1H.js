import{c as R,f as z,a as T,p as H,b as N,s as J,d as W,e as X,u as K,g as V,j as a,r as f,B as Y,R as Z,h as S,O as ee,i as te,P as re}from"./chunk-C37GKA54-B_Y8PyNr.js";import{G as se,r as A,u as ae}from"./registeredTheme-BQ-R_PVp.js";const oe=window.document;var w;const E=(w=oe.head.querySelector('meta[name="site-slug"]'))==null?void 0:w.content,m="/user",ne={user:null,accessToken:null,userProfileData:null},U=R({name:"auth",initialState:ne,reducers:{setUser:(e,t)=>{e.user=t.payload},removeUser:e=>{e.user=null},setAuth:(e,t)=>{e.user=t.payload.user,e.accessToken=t.payload.accessToken},setUserProfile:(e,t)=>{e.userProfileData=t.payload},clearAuth:e=>{e.accessToken=null,e.userProfileData=null,e.user=null}}}),{setUser:Ue,removeUser:qe,setAuth:j,clearAuth:L,setUserProfile:ie}=U.actions,ce=U.reducer,x=z({baseUrl:se,prepareHeaders:(e,t)=>{e.set("accept","application/json");let r=t.getState().auth.accessToken;return r||(r=JSON.parse(localStorage.getItem("persist:site")||"{}").auth.accessToken),r&&e.set("authorization",`Bearer ${r}`),e}}),ue=async(e,t,s)=>{const r=await x(e,t,s);return r.error&&r.error.status===401&&t.dispatch(L()),r},g=({url:e,method:t="GET",body:s,apiMethod:r})=>r?{url:e,method:t,body:{...s,_method:r}}:{url:e,method:t,body:s},y=T({reducerPath:"authApi",baseQuery:x,tagTypes:["User","LoggedInUser","UserProfileUpdate","UserUpdatePassword","PasswordForgotRequest","PasswordReset","DashboardAnalytics"],endpoints:e=>({login:e.mutation({query:t=>g({url:`${m}/login?store_id=${t.store_id}`,method:"post",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(o=>{s(j({user:o.data.data.user,accessToken:o.data.data.access_token}))})}}),register:e.mutation({query:t=>g({url:`${m}/register`,method:"post",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(o=>{s(j({user:o.data.data.user,accessToken:o.data.data.access_token}))})}}),logOut:e.mutation({query:t=>g({url:`${m}/logout`,method:"get",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(()=>{s(L())}).catch(()=>{s(L())})}})})}),{useLoginMutation:de,useRegisterMutation:le,useLogOutMutation:ge}=y,he={store:null},q=R({name:"store",initialState:he,reducers:{setStore:(e,t)=>{e.store=t.payload},clearStore:e=>{e.store=null}}}),{setStore:me,clearStore:_e}=q.actions,ye=q.reducer,p=T({reducerPath:"storeApi",baseQuery:x,tagTypes:["Store"],endpoints:e=>({fetchStore:e.query({query:t=>g({url:`/store?domain=${t.slug}`,method:"get"}),providesTags:["Store"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(o=>{var n,d;s(me((d=(n=o==null?void 0:o.data)==null?void 0:n.data)==null?void 0:d.store))})}})})}),{useFetchStoreQuery:pe}=p,P=T({reducerPath:"userApi",baseQuery:ue,tagTypes:["Profile"],endpoints:e=>({fetchUserProfile:e.query({query:()=>g({url:`${m}/profile`,method:"GET"}),providesTags:["Profile"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(o=>{s(ie(o.data.data.user))})}})})}),Se={items:null,qty:0,price:0},_=R({name:"cart",initialState:Se,reducers:{setCart:(e,t)=>{e.items=t.payload.items,e.qty=t.payload.qty,e.price=t.payload.price},setItems:(e,t)=>{e.items=t.payload},clearCart:e=>{e.items=null}}}),{setCart:ke,setItems:be,clearCart:Oe}=_.actions,fe=_.reducer,Ae={key:"site",blacklist:["storeApi","authApi","userApi"],storage:J,version:0},Le=H(Ae,N({store:ye,auth:ce,cart:fe,[p.reducerPath]:p.reducer,[y.reducerPath]:y.reducer,[P.reducerPath]:P.reducer})),k=W({reducer:Le,middleware:e=>e({serializableCheck:!1}).concat([p.middleware,y.middleware,P.middleware])});X(k);K.withTypes();const b=V.withTypes(),O=()=>{const{isLoading:e}=pe({slug:E}),{store:t}=b(s=>s.store);return{fetchStore:{isLoading:e},store:t}},Pe=()=>{const{user:e}=b(i=>i.auth),[t,{isLoading:s,error:r,data:o,isSuccess:n}]=de(),d=({formData:i,onSuccess:c})=>{t(i).then(u=>{var l;((l=u.data)==null?void 0:l.status)===200&&c&&c(u.data)})},[h,{isLoading:$,error:F,data:Q,isSuccess:v}]=le(),D=({formData:i,onSuccess:c})=>{h(i).then(u=>{var l;((l=u.data)==null?void 0:l.status)===200&&c&&c(u.data)})},[I,{isLoading:C,isSuccess:B,error:G,data:M}]=ge();return{user:e,login:{submit:d,isLoading:s,error:r,data:o,isSuccess:n},register:{submit:D,isLoading:$,error:F,data:Q,isSuccess:v},logOut:{submit:({onSuccess:i})=>{I().then(c=>{var u;((u=c.data)==null?void 0:u.status)===200&&i&&i(c.data.data)})},isLoading:C,error:G,data:M,isSuccess:B}}},Re=()=>({useAuth:Pe}),Te=function(e){const{store:t}=O(),s=Re();return a.jsx(a.Fragment,{children:e.widgets.slice().sort(function(r,o){return r.serial-o.serial}).map(r=>{var o;return a.jsx(a.Fragment,{children:t&&t.theme&&((o=A[t.theme.name])==null?void 0:o.widget({widget:r,store:t,hooks:s}))})})})},xe=function(){var r,o;const{store:e,fetchStore:t}=O(),{setColorShade:s}=ae();return f.useEffect(()=>{e&&e.theme&&s({name:"primary",color:e.primary_color??e.theme.primary_color})},[e]),a.jsx(a.Fragment,{children:a.jsx(Y,{basename:`/sites/${E}`,children:e&&e.theme?a.jsx(a.Fragment,{children:a.jsx(Z,{children:((r=e.pages)==null?void 0:r.length)>0?(o=e==null?void 0:e.pages)==null?void 0:o.map((n,d)=>{var h;return a.jsx(S,{path:"/",element:a.jsx(a.Fragment,{children:n.layout&&e.theme?A[e.theme.name]?(h=A[e.theme.name])==null?void 0:h.layout({store:e,layout:n.layout}):a.jsx("h1",{children:"Layout not found."}):a.jsx(ee,{})}),children:a.jsx(S,{path:n.type.type==="home"?"/":n.slug,index:!0,element:f.createElement(Te,{...n,key:d})},d)})}):a.jsx(S,{index:!0,element:a.jsx("h1",{children:"No page created."})})})}):a.jsx(a.Fragment,{children:t.isLoading&&"loading.."})})})};document.getElementById("root")&&te.createRoot(document.getElementById("root")).render(a.jsx(re,{store:k,children:a.jsx(f.StrictMode,{children:a.jsx(xe,{})})}));
