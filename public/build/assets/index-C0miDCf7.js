import{j as o,B as M,R as z,a as S,O as C,r as U,c as H}from"./chunk-K6AXKMTT-DJhFqiHr.js";import{c as w,f as N,G as J,a as P,p as W,b as X,d as K,e as V,u as Y,g as Z,s as ee,r as te,P as re}from"./registeredTheme-Bdz1ORpQ.js";const se=window.document;var T;const x=(T=se.head.querySelector('meta[name="site-slug"]'))==null?void 0:T.content,h="/user",ae={user:null,accessToken:null,userProfileData:null},E=w({name:"auth",initialState:ae,reducers:{setUser:(t,e)=>{t.user=e.payload},removeUser:t=>{t.user=null},setAuth:(t,e)=>{t.user=e.payload.user,t.accessToken=e.payload.accessToken},setUserProfile:(t,e)=>{t.userProfileData=e.payload},clearAuth:t=>{t.accessToken=null,t.userProfileData=null,t.user=null}}}),{setUser:xe,removeUser:Ee,setAuth:R,clearAuth:f,setUserProfile:oe}=E.actions,ne=E.reducer,A=N({baseUrl:J,prepareHeaders:(t,e)=>{t.set("accept","application/json");let r=e.getState().auth.accessToken;return r||(r=JSON.parse(localStorage.getItem("persist:site")||"{}").auth.accessToken),r&&t.set("authorization",`Bearer ${r}`),t}}),ie=async(t,e,s)=>{const r=await A(t,e,s);return r.error&&r.error.status===401&&e.dispatch(f()),r},l=({url:t,method:e="GET",body:s,apiMethod:r})=>r?{url:t,method:e,body:{...s,_method:r}}:{url:t,method:e,body:s},m=P({reducerPath:"authApi",baseQuery:A,tagTypes:["User","LoggedInUser","UserProfileUpdate","UserUpdatePassword","PasswordForgotRequest","PasswordReset","DashboardAnalytics"],endpoints:t=>({login:t.mutation({query:e=>l({url:`${h}/login?store_id=${e.store_id}`,method:"post",body:e}),invalidatesTags:["User"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:r}){await r.then(a=>{s(R({user:a.data.data.user,accessToken:a.data.data.access_token}))})}}),register:t.mutation({query:e=>l({url:`${h}/register`,method:"post",body:e}),invalidatesTags:["User"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:r}){await r.then(a=>{s(R({user:a.data.data.user,accessToken:a.data.data.access_token}))})}}),logOut:t.mutation({query:e=>l({url:`${h}/logout`,method:"get",body:e}),invalidatesTags:["User"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:r}){await r.then(()=>{s(f())}).catch(()=>{s(f())})}})})}),{useLoginMutation:ue,useRegisterMutation:ce,useLogOutMutation:de}=m,le={store:null},j=w({name:"store",initialState:le,reducers:{setStore:(t,e)=>{t.store=e.payload},clearStore:t=>{t.store=null}}}),{setStore:ge,clearStore:je}=j.actions,he=j.reducer,p=P({reducerPath:"storeApi",baseQuery:A,tagTypes:["Store"],endpoints:t=>({fetchStore:t.query({query:e=>l({url:`/store?domain=${e.slug}`,method:"get"}),providesTags:["Store"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:r}){await r.then(a=>{var c,g;s(ge((g=(c=a==null?void 0:a.data)==null?void 0:c.data)==null?void 0:g.store))})}})})}),{useFetchStoreQuery:me}=p,y=P({reducerPath:"userApi",baseQuery:ie,tagTypes:["Profile"],endpoints:t=>({fetchUserProfile:t.query({query:()=>l({url:`${h}/profile`,method:"GET"}),providesTags:["Profile"],transformErrorResponse:e=>e.data,async onQueryStarted(e,{dispatch:s,queryFulfilled:r}){await r.then(a=>{s(oe(a.data.data.user))})}})})}),{useFetchUserProfileQuery:pe}=y,ye={key:"site",blacklist:["storeApi","authApi","userApi"],storage:ee,version:0},Se=W(ye,X({store:he,auth:ne,[p.reducerPath]:p.reducer,[m.reducerPath]:m.reducer,[y.reducerPath]:y.reducer})),k=K({reducer:Se,middleware:t=>t({serializableCheck:!1}).concat([p.middleware,m.middleware,y.middleware])});V(k);Y.withTypes();const L=Z.withTypes(),_=()=>{const{isLoading:t}=me({slug:x}),{store:e}=L(s=>s.store);return{fetchStore:{isLoading:t},store:e}},fe=()=>{const{user:t}=L(n=>n.auth),[e,{isLoading:s,error:r,data:a,isSuccess:c}]=ue(),g=({formData:n,onSuccess:i})=>{e(n).then(u=>{var d;((d=u.data)==null?void 0:d.status)===200&&i&&i(u.data)})},[q,{isLoading:b,error:O,data:$,isSuccess:Q}]=ce(),D=({formData:n,onSuccess:i})=>{q(n).then(u=>{var d;((d=u.data)==null?void 0:d.status)===200&&i&&i(u.data)})},[F,{isLoading:v,isSuccess:B,error:I,data:G}]=de();return{user:t,login:{submit:g,isLoading:s,error:r,data:a,isSuccess:c},register:{submit:D,isLoading:b,error:O,data:$,isSuccess:Q},logOut:{submit:({onSuccess:n})=>{F().then(i=>{var u;((u=i.data)==null?void 0:u.status)===200&&n&&n(i.data.data)})},isLoading:v,error:I,data:G,isSuccess:B}}},Pe=()=>{const{userProfileData:t}=L(e=>e.auth);return pe(),{userProfileData:t}},Ae=()=>({useAuth:fe,useUser:Pe}),Le=function(t){const{store:e}=_(),s=Ae();return o.jsx(o.Fragment,{children:t.widgets.slice().sort(function(r,a){return r.serial-a.serial}).map(r=>{var a;return o.jsx(o.Fragment,{children:e&&e.theme&&((a=te[e.theme.name])==null?void 0:a.widget({widget:r,store:e,hooks:s}))})})})},Re=function(){var s,r;const{store:t,fetchStore:e}=_();return o.jsx(o.Fragment,{children:o.jsx(M,{basename:`/sites/${x}`,children:t?o.jsx(o.Fragment,{children:o.jsx(z,{children:((s=t.pages)==null?void 0:s.length)>0?(r=t==null?void 0:t.pages)==null?void 0:r.map((a,c)=>o.jsx(S,{path:"/",element:o.jsx(C,{}),children:o.jsx(S,{path:a.type.type==="home"?"/":a.slug,index:!0,element:U.createElement(Le,{...a,key:c})},c)})):o.jsx(S,{index:!0,element:o.jsx("h1",{children:"No page created."})})})}):o.jsx(o.Fragment,{children:e.isLoading&&"loading.."})})})};document.getElementById("root")&&H.createRoot(document.getElementById("root")).render(o.jsx(re,{store:k,children:o.jsx(U.StrictMode,{children:o.jsx(Re,{})})}));
