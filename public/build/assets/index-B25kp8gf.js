import{j as r,B as E,R as P,a as h,O as b,r as f,c as q}from"./chunk-K6AXKMTT-DJhFqiHr.js";import{c as R,a as x,h as _,G as $,p as F,b as Q,d as v,e as B,u as I,f as O,s as D,P as G}from"./index-eS5U9zE4.js";import{b as H,c as m,U as p}from"./theme_env-uGrSUN3A.js";import{T as C}from"./getComponent-BsI7XjWs.js";const M={user:null,accessToken:null},A=R({name:"auth",initialState:M,reducers:{setUser:(e,t)=>{e.user=t.payload},removeUser:e=>{e.user=null},setAuth:(e,t)=>{e.user=t.payload.user,e.accessToken=t.payload.accessToken},clearAuth:e=>{e.accessToken=null,e.user=null}}}),{setUser:me,removeUser:pe,setAuth:y,clearAuth:z}=A.actions,N=A.reducer,u=x({reducerPath:"authApi",baseQuery:H,tagTypes:["User","LoggedInUser","UserProfileUpdate","UserUpdatePassword","PasswordForgotRequest","PasswordReset","DashboardAnalytics"],endpoints:e=>({login:e.mutation({query:t=>m({url:`${p}/login`,method:"post",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:a}){await a.then(o=>{s(y({user:o.data.data.user,accessToken:o.data.data.access_token}))})}}),register:e.mutation({query:t=>m({url:`${p}/register`,method:"post",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:a}){await a.then(o=>{s(y({user:o.data.data.user,accessToken:o.data.data.access_token}))})}}),logOut:e.mutation({query:t=>m({url:`${p}/logout`,method:"get",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:a}){await a.then(()=>{s(z())})}})})}),{useLoginMutation:X,useRegisterMutation:J,useLogOutMutation:ye}=u,K=_({baseUrl:$,prepareHeaders:e=>(e.set("accept","application/json"),e)}),V=({url:e,method:t="GET",body:s,apiMethod:a})=>a?{url:e,method:t,body:{...s,_method:a}}:{url:e,method:t,body:s},W={store:null},j=R({name:"store",initialState:W,reducers:{setStore:(e,t)=>{e.store=t.payload},clearStore:e=>{e.store=null}}}),{setStore:Y,clearStore:Se}=j.actions,Z=j.reducer,d=x({reducerPath:"storeApi",baseQuery:K,tagTypes:["Store"],endpoints:e=>({fetchStore:e.query({query:t=>V({url:`/store?domain=${t.slug}`,method:"get"}),providesTags:["Store"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:a}){await a.then(o=>{var n,c;s(Y((c=(n=o==null?void 0:o.data)==null?void 0:n.data)==null?void 0:c.store))})}})})}),{useFetchStoreQuery:ee}=d,te={key:"site",blacklist:["storeApi"],storage:D,version:0},re=F(te,Q({store:Z,auth:N,[d.reducerPath]:d.reducer,[u.reducerPath]:u.reducer})),L=v({reducer:re,middleware:e=>e({serializableCheck:!1}).concat([d.middleware,u.middleware])});B(L);I.withTypes();const se=O.withTypes(),ae=window.document;var S;const T=(S=ae.head.querySelector('meta[name="site-slug"]'))==null?void 0:S.content,U=()=>{const{isLoading:e}=ee({slug:T}),{store:t}=se(s=>s.store);return{fetchStore:{isLoading:e},store:t}},oe=()=>{const[e,{isLoading:t,error:s,data:a}]=X(),o=({formData:l,onSuccess:i})=>{e(l).then(g=>{console.log("login re",g),i&&i()})},[n,{isLoading:c,error:k,data:w}]=J();return{login:{submit:o,isLoading:t,error:s,data:a},register:{submit:({formData:l,onSuccess:i})=>{n(l).then(g=>{console.log("login re",g),i&&i()})},isLoading:c,error:k,data:w}}},ne=()=>({auth:oe()}),ie=function(e){const{store:t}=U(),{auth:s}=ne();return r.jsx(r.Fragment,{children:e.widgets.slice().sort(function(a,o){return a.serial-o.serial}).map(a=>r.jsx(r.Fragment,{children:t&&t.theme&&r.jsx(C,{store:t,widget:a,theme:t.theme,hooks:{auth:s}})}))})},ce=function(){var s,a;const{store:e,fetchStore:t}=U();return r.jsx(r.Fragment,{children:r.jsx(E,{basename:`/sites/${T}`,children:e?r.jsx(r.Fragment,{children:r.jsx(P,{children:((s=e.pages)==null?void 0:s.length)>0?(a=e==null?void 0:e.pages)==null?void 0:a.map((o,n)=>r.jsx(h,{path:"/",element:r.jsx(b,{}),children:r.jsx(h,{path:o.type.type==="home"?"/":o.slug,index:!0,element:f.createElement(ie,{...o,key:n})},n)})):r.jsx(h,{index:!0,element:r.jsx("h1",{children:"No page created."})})})}):r.jsx(r.Fragment,{children:t.isLoading&&"loading.."})})})};document.getElementById("root")&&q.createRoot(document.getElementById("root")).render(r.jsx(G,{store:L,children:r.jsx(f.StrictMode,{children:r.jsx(ce,{})})}));
