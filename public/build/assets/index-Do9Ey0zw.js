import{c as R,f as M,a as T,p as z,b as H,d as N,e as J,u as W,g as X,s as K,j as a,r as f,B as V,R as Y,h as S,O as Z,i as ee,P as te}from"./index.esm-CvKGStPr.js";import{G as re,r as A,u as se}from"./registeredTheme-OYvXb4XV.js";const ae=window.document;var w;const E=(w=ae.head.querySelector('meta[name="site-slug"]'))==null?void 0:w.content,m="/user",oe={user:null,accessToken:null,userProfileData:null},U=R({name:"auth",initialState:oe,reducers:{setUser:(e,t)=>{e.user=t.payload},removeUser:e=>{e.user=null},setAuth:(e,t)=>{e.user=t.payload.user,e.accessToken=t.payload.accessToken},setUserProfile:(e,t)=>{e.userProfileData=t.payload},clearAuth:e=>{e.accessToken=null,e.userProfileData=null,e.user=null}}}),{setUser:Ue,removeUser:qe,setAuth:j,clearAuth:L,setUserProfile:ne}=U.actions,ie=U.reducer,x=M({baseUrl:re,prepareHeaders:(e,t)=>{e.set("accept","application/json");let r=t.getState().auth.accessToken;return r||(r=JSON.parse(localStorage.getItem("persist:site")||"{}").auth.accessToken),r&&e.set("authorization",`Bearer ${r}`),e}}),ce=async(e,t,s)=>{const r=await x(e,t,s);return r.error&&r.error.status===401&&t.dispatch(L()),r},g=({url:e,method:t="GET",body:s,apiMethod:r})=>r?{url:e,method:t,body:{...s,_method:r}}:{url:e,method:t,body:s},y=T({reducerPath:"authApi",baseQuery:x,tagTypes:["User","LoggedInUser","UserProfileUpdate","UserUpdatePassword","PasswordForgotRequest","PasswordReset","DashboardAnalytics"],endpoints:e=>({login:e.mutation({query:t=>g({url:`${m}/login?store_id=${t.store_id}`,method:"post",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(o=>{s(j({user:o.data.data.user,accessToken:o.data.data.access_token}))})}}),register:e.mutation({query:t=>g({url:`${m}/register`,method:"post",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(o=>{s(j({user:o.data.data.user,accessToken:o.data.data.access_token}))})}}),logOut:e.mutation({query:t=>g({url:`${m}/logout`,method:"get",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(()=>{s(L())}).catch(()=>{s(L())})}})})}),{useLoginMutation:ue,useRegisterMutation:de,useLogOutMutation:le}=y,ge={store:null},q=R({name:"store",initialState:ge,reducers:{setStore:(e,t)=>{e.store=t.payload},clearStore:e=>{e.store=null}}}),{setStore:he,clearStore:_e}=q.actions,me=q.reducer,p=T({reducerPath:"storeApi",baseQuery:x,tagTypes:["Store"],endpoints:e=>({fetchStore:e.query({query:t=>g({url:`/store?domain=${t.slug}`,method:"get"}),providesTags:["Store"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(o=>{var n,d;s(he((d=(n=o==null?void 0:o.data)==null?void 0:n.data)==null?void 0:d.store))})}})})}),{useFetchStoreQuery:ye}=p,P=T({reducerPath:"userApi",baseQuery:ce,tagTypes:["Profile"],endpoints:e=>({fetchUserProfile:e.query({query:()=>g({url:`${m}/profile`,method:"GET"}),providesTags:["Profile"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(o=>{s(ne(o.data.data.user))})}})})}),pe={items:null,qty:0,price:0},Se=R({name:"cart",initialState:pe,reducers:{setCart:(e,t)=>{e.items=t.payload.items,e.qty=t.payload.qty,e.price=t.payload.price},setItems:(e,t)=>{e.items=t.payload},clearCart:e=>{e.items=null}}}),fe=Se.reducer,Ae={key:"site",blacklist:["storeApi","authApi","userApi"],storage:K,version:0},Le=z(Ae,H({store:me,auth:ie,cart:fe,[p.reducerPath]:p.reducer,[y.reducerPath]:y.reducer,[P.reducerPath]:P.reducer})),_=N({reducer:Le,middleware:e=>e({serializableCheck:!1}).concat([p.middleware,y.middleware,P.middleware])});J(_);W.withTypes();const k=X.withTypes(),b=()=>{const{isLoading:e}=ye({slug:E}),{store:t}=k(s=>s.store);return{fetchStore:{isLoading:e},store:t}},Pe=()=>{const{user:e}=k(i=>i.auth),[t,{isLoading:s,error:r,data:o,isSuccess:n}]=ue(),d=({formData:i,onSuccess:c})=>{t(i).then(u=>{var l;((l=u.data)==null?void 0:l.status)===200&&c&&c(u.data)})},[h,{isLoading:O,error:$,data:F,isSuccess:Q}]=de(),v=({formData:i,onSuccess:c})=>{h(i).then(u=>{var l;((l=u.data)==null?void 0:l.status)===200&&c&&c(u.data)})},[D,{isLoading:I,isSuccess:B,error:C,data:G}]=le();return{user:e,login:{submit:d,isLoading:s,error:r,data:o,isSuccess:n},register:{submit:v,isLoading:O,error:$,data:F,isSuccess:Q},logOut:{submit:({onSuccess:i})=>{D().then(c=>{var u;((u=c.data)==null?void 0:u.status)===200&&i&&i(c.data.data)})},isLoading:I,error:C,data:G,isSuccess:B}}},Re=()=>({useAuth:Pe}),Te=function(e){const{store:t}=b(),s=Re();return a.jsx(a.Fragment,{children:e.widgets.slice().sort(function(r,o){return r.serial-o.serial}).map(r=>{var o;return a.jsx(a.Fragment,{children:t&&t.theme&&((o=A[t.theme.name])==null?void 0:o.widget({widget:r,store:t,hooks:s}))})})})},xe=function(){var r,o;const{store:e,fetchStore:t}=b(),{setColorShade:s}=se();return f.useEffect(()=>{e&&e.theme&&s({name:"primary",color:e.primary_color??e.theme.primary_color})},[e]),a.jsx(a.Fragment,{children:a.jsx(V,{basename:`/sites/${E}`,children:e&&e.theme?a.jsx(a.Fragment,{children:a.jsx(Y,{children:((r=e.pages)==null?void 0:r.length)>0?(o=e==null?void 0:e.pages)==null?void 0:o.map((n,d)=>{var h;return a.jsx(S,{path:"/",element:a.jsx(a.Fragment,{children:n.layout&&e.theme?A[e.theme.name]?(h=A[e.theme.name])==null?void 0:h.layout({store:e,layout:n.layout}):a.jsx("h1",{children:"Layout not found."}):a.jsx(Z,{})}),children:a.jsx(S,{path:n.type.type==="home"?"/":n.slug,index:!0,element:f.createElement(Te,{...n,key:d})},d)})}):a.jsx(S,{index:!0,element:a.jsx("h1",{children:"No page created."})})})}):a.jsx(a.Fragment,{children:t.isLoading&&"loading.."})})})};document.getElementById("root")&&ee.createRoot(document.getElementById("root")).render(a.jsx(te,{store:_,children:a.jsx(f.StrictMode,{children:a.jsx(xe,{})})}));
