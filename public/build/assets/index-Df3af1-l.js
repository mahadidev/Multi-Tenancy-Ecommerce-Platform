import{c as w,f as M,a as R,p as z,b as H,d as N,e as J,u as W,g as X,s as K,j as a,r as P,B as V,R as Y,h as S,O as Z,i as ee,P as te}from"./index.esm-Dryv6f9h.js";import{G as re,r as A,u as se}from"./registeredTheme-CGrWazgv.js";const ae=window.document;var j;const E=(j=ae.head.querySelector('meta[name="site-slug"]'))==null?void 0:j.content,m="/user",oe={user:null,accessToken:null,userProfileData:null},_=w({name:"auth",initialState:oe,reducers:{setUser:(e,t)=>{e.user=t.payload},removeUser:e=>{e.user=null},setAuth:(e,t)=>{e.user=t.payload.user,e.accessToken=t.payload.accessToken},setUserProfile:(e,t)=>{e.userProfileData=t.payload},clearAuth:e=>{e.accessToken=null,e.userProfileData=null,e.user=null}}}),{setUser:we,removeUser:Ee,setAuth:U,clearAuth:L,setUserProfile:ne}=_.actions,ie=_.reducer,T=M({baseUrl:re,prepareHeaders:(e,t)=>{e.set("accept","application/json");let r=t.getState().auth.accessToken;return r||(r=JSON.parse(localStorage.getItem("persist:site")||"{}").auth.accessToken),r&&e.set("authorization",`Bearer ${r}`),e}}),ue=async(e,t,s)=>{const r=await T(e,t,s);return r.error&&r.error.status===401&&t.dispatch(L()),r},g=({url:e,method:t="GET",body:s,apiMethod:r})=>r?{url:e,method:t,body:{...s,_method:r}}:{url:e,method:t,body:s},y=R({reducerPath:"authApi",baseQuery:T,tagTypes:["User","LoggedInUser","UserProfileUpdate","UserUpdatePassword","PasswordForgotRequest","PasswordReset","DashboardAnalytics"],endpoints:e=>({login:e.mutation({query:t=>g({url:`${m}/login?store_id=${t.store_id}`,method:"post",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(o=>{s(U({user:o.data.data.user,accessToken:o.data.data.access_token}))})}}),register:e.mutation({query:t=>g({url:`${m}/register`,method:"post",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(o=>{s(U({user:o.data.data.user,accessToken:o.data.data.access_token}))})}}),logOut:e.mutation({query:t=>g({url:`${m}/logout`,method:"get",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(()=>{s(L())}).catch(()=>{s(L())})}})})}),{useLoginMutation:ce,useRegisterMutation:de,useLogOutMutation:le}=y,ge={store:null},k=w({name:"store",initialState:ge,reducers:{setStore:(e,t)=>{e.store=t.payload},clearStore:e=>{e.store=null}}}),{setStore:he,clearStore:_e}=k.actions,me=k.reducer,p=R({reducerPath:"storeApi",baseQuery:T,tagTypes:["Store"],endpoints:e=>({fetchStore:e.query({query:t=>g({url:`/store?domain=${t.slug}`,method:"get"}),providesTags:["Store"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(o=>{var n,d;s(he((d=(n=o==null?void 0:o.data)==null?void 0:n.data)==null?void 0:d.store))})}})})}),{useFetchStoreQuery:ye}=p,f=R({reducerPath:"userApi",baseQuery:ue,tagTypes:["Profile"],endpoints:e=>({fetchUserProfile:e.query({query:()=>g({url:`${m}/profile`,method:"GET"}),providesTags:["Profile"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(o=>{s(ne(o.data.data.user))})}})})}),{useFetchUserProfileQuery:pe}=f,fe={key:"site",blacklist:["storeApi","authApi","userApi"],storage:K,version:0},Se=z(fe,H({store:me,auth:ie,[p.reducerPath]:p.reducer,[y.reducerPath]:y.reducer,[f.reducerPath]:f.reducer})),q=N({reducer:Se,middleware:e=>e({serializableCheck:!1}).concat([p.middleware,y.middleware,f.middleware])});J(q);W.withTypes();const x=X.withTypes(),b=()=>{const{isLoading:e}=ye({slug:E}),{store:t}=x(s=>s.store);return{fetchStore:{isLoading:e},store:t}},Pe=()=>{const{user:e}=x(i=>i.auth),[t,{isLoading:s,error:r,data:o,isSuccess:n}]=ce(),d=({formData:i,onSuccess:u})=>{t(i).then(c=>{var l;((l=c.data)==null?void 0:l.status)===200&&u&&u(c.data)})},[h,{isLoading:O,error:$,data:F,isSuccess:Q}]=de(),D=({formData:i,onSuccess:u})=>{h(i).then(c=>{var l;((l=c.data)==null?void 0:l.status)===200&&u&&u(c.data)})},[v,{isLoading:B,isSuccess:I,error:G,data:C}]=le();return{user:e,login:{submit:d,isLoading:s,error:r,data:o,isSuccess:n},register:{submit:D,isLoading:O,error:$,data:F,isSuccess:Q},logOut:{submit:({onSuccess:i})=>{v().then(u=>{var c;((c=u.data)==null?void 0:c.status)===200&&i&&i(u.data.data)})},isLoading:B,error:G,data:C,isSuccess:I}}},Ae=()=>{const{userProfileData:e}=x(t=>t.auth);return pe(),{userProfileData:e}},Le=()=>({useAuth:Pe,useUser:Ae}),Re=function(e){const{store:t}=b(),s=Le();return a.jsx(a.Fragment,{children:e.widgets.slice().sort(function(r,o){return r.serial-o.serial}).map(r=>{var o;return a.jsx(a.Fragment,{children:t&&t.theme&&((o=A[t.theme.name])==null?void 0:o.widget({widget:r,store:t,hooks:s}))})})})},Te=function(){var r,o;const{store:e,fetchStore:t}=b(),{setColorShade:s}=se();return P.useEffect(()=>{e&&e.theme&&s({name:"primary",color:e.primary_color??e.theme.primary_color})},[e]),a.jsx(a.Fragment,{children:a.jsx(V,{basename:`/sites/${E}`,children:e&&e.theme?a.jsx(a.Fragment,{children:a.jsx(Y,{children:((r=e.pages)==null?void 0:r.length)>0?(o=e==null?void 0:e.pages)==null?void 0:o.map((n,d)=>{var h;return a.jsx(S,{path:"/",element:a.jsx(a.Fragment,{children:n.layout&&e.theme?A[e.theme.name]?(h=A[e.theme.name])==null?void 0:h.layout({store:e,layout:n.layout}):a.jsx("h1",{children:"Layout not found."}):a.jsx(Z,{})}),children:a.jsx(S,{path:n.type.type==="home"?"/":n.slug,index:!0,element:P.createElement(Re,{...n,key:d})},d)})}):a.jsx(S,{index:!0,element:a.jsx("h1",{children:"No page created."})})})}):a.jsx(a.Fragment,{children:t.isLoading&&"loading.."})})})};document.getElementById("root")&&ee.createRoot(document.getElementById("root")).render(a.jsx(te,{store:q,children:a.jsx(P.StrictMode,{children:a.jsx(Te,{})})}));
