import{j as o,r as S,B as z,R as C,a as f,O as H,c as N}from"./index.esm-Bz6LD8J2.js";import{c as E,f as J,G as W,a as L,p as X,b as K,d as V,e as Y,u as Z,g as ee,s as te,r as P,P as re}from"./registeredTheme-B2mHd502.js";const se=window.document;var U;const j=(U=se.head.querySelector('meta[name="site-slug"]'))==null?void 0:U.content,h="/user",ae={user:null,accessToken:null,userProfileData:null},w=E({name:"auth",initialState:ae,reducers:{setUser:(e,t)=>{e.user=t.payload},removeUser:e=>{e.user=null},setAuth:(e,t)=>{e.user=t.payload.user,e.accessToken=t.payload.accessToken},setUserProfile:(e,t)=>{e.userProfileData=t.payload},clearAuth:e=>{e.accessToken=null,e.userProfileData=null,e.user=null}}}),{setUser:Ee,removeUser:je,setAuth:x,clearAuth:A,setUserProfile:oe}=w.actions,ne=w.reducer,R=J({baseUrl:W,prepareHeaders:(e,t)=>{e.set("accept","application/json");let r=t.getState().auth.accessToken;return r||(r=JSON.parse(localStorage.getItem("persist:site")||"{}").auth.accessToken),r&&e.set("authorization",`Bearer ${r}`),e}}),ie=async(e,t,s)=>{const r=await R(e,t,s);return r.error&&r.error.status===401&&t.dispatch(A()),r},g=({url:e,method:t="GET",body:s,apiMethod:r})=>r?{url:e,method:t,body:{...s,_method:r}}:{url:e,method:t,body:s},m=L({reducerPath:"authApi",baseQuery:R,tagTypes:["User","LoggedInUser","UserProfileUpdate","UserUpdatePassword","PasswordForgotRequest","PasswordReset","DashboardAnalytics"],endpoints:e=>({login:e.mutation({query:t=>g({url:`${h}/login?store_id=${t.store_id}`,method:"post",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(a=>{s(x({user:a.data.data.user,accessToken:a.data.data.access_token}))})}}),register:e.mutation({query:t=>g({url:`${h}/register`,method:"post",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(a=>{s(x({user:a.data.data.user,accessToken:a.data.data.access_token}))})}}),logOut:e.mutation({query:t=>g({url:`${h}/logout`,method:"get",body:t}),invalidatesTags:["User"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(()=>{s(A())}).catch(()=>{s(A())})}})})}),{useLoginMutation:ue,useRegisterMutation:ce,useLogOutMutation:de}=m,le={store:null},_=E({name:"store",initialState:le,reducers:{setStore:(e,t)=>{e.store=t.payload},clearStore:e=>{e.store=null}}}),{setStore:ge,clearStore:we}=_.actions,he=_.reducer,y=L({reducerPath:"storeApi",baseQuery:R,tagTypes:["Store"],endpoints:e=>({fetchStore:e.query({query:t=>g({url:`/store?domain=${t.slug}`,method:"get"}),providesTags:["Store"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(a=>{var c,d;s(ge((d=(c=a==null?void 0:a.data)==null?void 0:c.data)==null?void 0:d.store))})}})})}),{useFetchStoreQuery:me}=y,p=L({reducerPath:"userApi",baseQuery:ie,tagTypes:["Profile"],endpoints:e=>({fetchUserProfile:e.query({query:()=>g({url:`${h}/profile`,method:"GET"}),providesTags:["Profile"],transformErrorResponse:t=>t.data,async onQueryStarted(t,{dispatch:s,queryFulfilled:r}){await r.then(a=>{s(oe(a.data.data.user))})}})})}),{useFetchUserProfileQuery:ye}=p,pe={key:"site",blacklist:["storeApi","authApi","userApi"],storage:te,version:0},fe=X(pe,K({store:he,auth:ne,[y.reducerPath]:y.reducer,[m.reducerPath]:m.reducer,[p.reducerPath]:p.reducer})),k=V({reducer:fe,middleware:e=>e({serializableCheck:!1}).concat([y.middleware,m.middleware,p.middleware])});Y(k);Z.withTypes();const T=ee.withTypes(),q=()=>{const{isLoading:e}=me({slug:j}),{store:t}=T(s=>s.store);return{fetchStore:{isLoading:e},store:t}},Se=()=>{const{user:e}=T(n=>n.auth),[t,{isLoading:s,error:r,data:a,isSuccess:c}]=ue(),d=({formData:n,onSuccess:i})=>{t(n).then(u=>{var l;((l=u.data)==null?void 0:l.status)===200&&i&&i(u.data)})},[b,{isLoading:O,error:$,data:F,isSuccess:Q}]=ce(),D=({formData:n,onSuccess:i})=>{b(n).then(u=>{var l;((l=u.data)==null?void 0:l.status)===200&&i&&i(u.data)})},[v,{isLoading:B,isSuccess:I,error:G,data:M}]=de();return{user:e,login:{submit:d,isLoading:s,error:r,data:a,isSuccess:c},register:{submit:D,isLoading:O,error:$,data:F,isSuccess:Q},logOut:{submit:({onSuccess:n})=>{v().then(i=>{var u;((u=i.data)==null?void 0:u.status)===200&&n&&n(i.data.data)})},isLoading:B,error:G,data:M,isSuccess:I}}},Pe=()=>{const{userProfileData:e}=T(t=>t.auth);return ye(),{userProfileData:e}},Ae=()=>({useAuth:Se,useUser:Pe}),Le=function(e){const{store:t}=q(),s=Ae();return o.jsx(o.Fragment,{children:e.widgets.slice().sort(function(r,a){return r.serial-a.serial}).map(r=>{var a;return o.jsx(o.Fragment,{children:t&&t.theme&&((a=P[t.theme.name])==null?void 0:a.widget({widget:r,store:t,hooks:s}))})})})},Re=function(){var s,r;const{store:e,fetchStore:t}=q();return S.useEffect(()=>{e&&e.theme&&document.documentElement.style.setProperty("--store-primary-color",e.primary_color??e.theme.primary_color)},[e]),o.jsx(o.Fragment,{children:o.jsx(z,{basename:`/sites/${j}`,children:e&&e.theme?o.jsx(o.Fragment,{children:o.jsx(C,{children:((s=e.pages)==null?void 0:s.length)>0?(r=e==null?void 0:e.pages)==null?void 0:r.map((a,c)=>{var d;return o.jsx(f,{path:"/",element:o.jsx(o.Fragment,{children:a.layout&&e.theme?P[e.theme.name]?(d=P[e.theme.name])==null?void 0:d.layout({store:e,layout:a.layout}):o.jsx("h1",{children:"Layout not found."}):o.jsx(H,{})}),children:o.jsx(f,{path:a.type.type==="home"?"/":a.slug,index:!0,element:S.createElement(Le,{...a,key:c})},c)})}):o.jsx(f,{index:!0,element:o.jsx("h1",{children:"No page created."})})})}):o.jsx(o.Fragment,{children:t.isLoading&&"loading.."})})})};document.getElementById("root")&&N.createRoot(document.getElementById("root")).render(o.jsx(re,{store:k,children:o.jsx(S.StrictMode,{children:o.jsx(Re,{})})}));
